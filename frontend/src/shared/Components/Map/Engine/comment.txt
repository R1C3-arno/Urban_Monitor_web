[UI Component]
   â†“
[Hook] useFeatureData / useFeatureReport
   â†“
[Service] FeatureAPIService / FeatureMockService
   â†“
[Mapper] featureDataMapper
   â†“
[Domain Model] FeatureIncident / FeatureZone / FeatureReport
   â†“
[Map Engine] BaseMap + BaseZone + BaseMarker




FLOW LOAD DATA HIá»‚N THá»Š MAP (Polygon + Marker)

User vÃ o Map Page
   â†“
FeatureMap.jsx
   â†“
useFeatureData()
   â†“
FeatureAPIService.getIncidents()
   â†“
Backend tráº£ vá» JSON
   â†“
featureDataMapper()
   â†“
BaseIncident / BaseZone
   â†“
BaseMap render polygon + marker

Má»¥c tiÃªu:

UI khÃ´ng biáº¿t backend

Backend khÃ´ng biáº¿t UI

Mapper chá»‹u trÃ¡ch nhiá»‡m "dá»‹ch ngÃ´n ngá»¯"




FLOW REPORT (Gá»¬I Sá»° Cá» Tá»ª USER LÃŠN BACKEND)

User click "Report"
   â†“
FeatureReportForm.jsx
   â†“
useFeatureReport()
   â†“
FeatureReportAPIService.submitReport()
   â†“
Backend lÆ°u DB
   â†“
Tráº£ vá» incident má»›i
   â†“
Map tá»± cáº­p nháº­t marker



FLOW REPORT (Gá»¬I Sá»° Cá» Tá»ª USER LÃŠN BACKEND)

User click "Report"
   â†“
FeatureReportForm.jsx
   â†“
useFeatureReport()
   â†“
FeatureReportAPIService.submitReport()
   â†“
Backend lÆ°u DB
   â†“
Tráº£ vá» incident má»›i
   â†“
Map tá»± cáº­p nháº­t marker





API GET INCIDENTS (Traffic | Security | Disaster | Emergency | Market)
Endpoint máº«u:
GET /api/traffic/incidents
GET /api/security/incidents
GET /api/disaster/incidents
GET /api/market/incidents
Response chuáº©n backend pháº£i tráº£:
[
  {
    "id": "abc123",
    "title": "Tai náº¡n giao thÃ´ng",
    "description": "Va cháº¡m xe mÃ¡y",
    "lat": 10.762622,
    "lng": 106.660172,
    "level": "HIGH",
    "category": "ACCIDENT",
    "image": "https://cdn.com/image.jpg",
    "radius": 300,
    "createdAt": "2025-12-06T08:00:00Z"
  }
]


Mapping vÃ o Domain:

API SUBMIT REPORT
Endpoint máº«u:
POST /api/traffic/report
POST /api/security/report
...


Request Backend nháº­n:
{
  "title": "CÆ°á»›p giáº­t",
  "description": "CÃ³ cÆ°á»›p gáº§n chá»£",
  "lat": 10.76,
  "lng": 106.66,
  "image": "base64..."
}


Backend tráº£ vá» sau khi lÆ°u:
{
  "id": "new123",
  "title": "CÆ°á»›p giáº­t",
  "description": "CÃ³ cÆ°á»›p gáº§n chá»£",
  "lat": 10.76,
  "lng": 106.66,
  "level": "MEDIUM",
  "radius": 200,
  "status": "PENDING"
}


â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Database  â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
       â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚        BACKEND           â”‚  NÆ I DUY NHáº¤T Xá»¬ LÃ LOGIC
â”‚--------------------------â”‚
â”‚ - PhÃ¢n loáº¡i level        â”‚
â”‚ - TÃ­nh bÃ¡n kÃ­nh          â”‚
â”‚ - Sinh polygon           â”‚
â”‚ - GÃ¡n mÃ u theo má»©c Ä‘á»™    â”‚
â”‚ - Validate report        â”‚
â”‚ - Anti-spam              â”‚
â”‚ - Gom vÃ¹ng chá»“ng láº¥p     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â†“ JSON CHUáº¨N
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚        FRONTEND          â”‚  CHá»ˆ LÃ€ VIEW ENGINE
â”‚--------------------------â”‚
â”‚ - Váº½ polygon             â”‚
â”‚ - Gáº¯n marker             â”‚
â”‚ - Má»Ÿ popup               â”‚
â”‚ - Gá»­i report form        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Há»¢P Äá»’NG JSON CHUáº¨N TOÃ€N PROJECT (DÃ™NG CHUNG CHO TRAFFIC / SECURITY / DISASTER / MARKET)


INCIDENT (Marker)
{
  "id": "inc-123",
  "title": "Tai náº¡n ngÃ£ tÆ°",
  "description": "Xe mÃ¡y va cháº¡m Ã´ tÃ´",
  "lat": 10.762622,
  "lng": 106.660172,
  "level": "HIGH",
  "icon": "car-crash.png",
  "image": "https://..."
}
\
Backend chá»‹u trÃ¡ch nhiá»‡m:

Level

Icon

Data hiá»ƒn thá»‹

Frontend chá»‰:

new BaseIncident(apiData)


ZONE (Polygon trÃ²n)

{
  "id": "zone-123",
  "coords": [
    [106.6601, 10.7626],
    [106.6605, 10.7629],
    [106.6609, 10.7626],
    [106.6601, 10.7626]
  ],
  "level": "HIGH",
  "color": "#EF4444",
  "opacity": 0.35
}


oÃ n bá»™:

Polygon

Color

Opacity
==> Backend xá»­ lÃ½ háº¿t

Frontend:

new BaseZone(apiData)


REPORT SUBMIT (Frontend â†’ Backend)
{
  "title": "CÆ°á»›p giáº­t",
  "description": "Hai ngÆ°á»i giáº­t Ä‘iá»‡n thoáº¡i",
  "lat": 10.77,
  "lng": 106.66,
  "image": "base64..."
}

Backend lÃ m:

Validate

GÃ¡n level

Gá»™p zone

Sinh zone má»›i náº¿u cáº§n
POST /report


SHARED BASE CLASS PHáº¢I THEO ÄÃšNG TRIáº¾T LÃ NÃ€Y
 BaseIncident (FE chá»‰ Ä‘á»c)

export class BaseIncident {
    constructor({ id, title, description, lat, lng, level, icon, image }) {
        this._id = id;
        this._title = title;
        this._description = description;
        this._coords = [lng, lat];
        this._level = level;
        this._icon = icon;
        this._image = image;

        Object.freeze(this);
    }

    get id() { return this._id; }
    get title() { return this._title; }
    get description() { return this._description; }
    get coords() { return this._coords; }
    get level() { return this._level; }
    get icon() { return this._icon; }
    get image() { return this._image; }

    toJSON() {
        return {
            id: this._id,
            title: this._title,
            description: this._description,
            coords: this._coords,
            level: this._level,
            icon: this._icon,
            image: this._image,
        };
    }
}


BaseZone (KHÃ”NG CÃ“ TÃNH TOÃN)

export class BaseZone {
    constructor({ id, coords, level, color, opacity = 0.3 }) {
        this._id = id;
        this._coords = coords;     //  Backend gá»­i sáºµn
        this._level = level;
        this._color = color;
        this._opacity = opacity;

        Object.freeze(this);
    }

    get id() { return this._id; }
    get coords() { return this._coords; }
    get level() { return this._level; }
    get color() { return this._color; }
    get opacity() { return this._opacity; }

    toGeoJSON() {
        return {
            type: "Feature",
            geometry: {
                type: "Polygon",
                coordinates: [this._coords],
            },
        };
    }
}


useBaseMapData UX HOÃ€N TOÃ€N KHá»šP Vá»šI TRIáº¾T LÃ â€œBACKEND LÃ€ NÃƒOâ€

const raw = await dataSource.fetchItems();

// FE khÃ´ng xá»­ lÃ½ logic
const incidents = mapToIncidents(raw.incidents);
const zones = mapToZones(raw.zones);


Backend pháº£i tráº£:
{
  "incidents": [...],
  "zones": [...]
}


Má»–I FEATURE CHá»ˆ CÃ’N 3 THá»¨

VÃ­ dá»¥: Security

security/
 â”œâ”€ hooks/
 â”‚   â””â”€ useSecurityData.js   ==> chá»‰ gá»i shared
 â”œâ”€ mappers/
 â”‚   â””â”€ mapSecurityMarkers.js ==> Ä‘á»•i icon/style
 â”œâ”€ components/
 â”‚   â””â”€ SecurityMap.jsx ==> render map

 Security KHÃ”NG Ä‘Æ°á»£c phÃ©p:

 Tá»± tÃ­nh zone

 Tá»± gÃ¡n mÃ u level

 Tá»± suy Ä‘oÃ¡n danger

 Káº¾T LUáº¬N KIáº¾N TRÃšC (CHá»T Cá»¨NG)
 Vai trÃ²	ÄÆ°á»£c lÃ m	Cáº¥m lÃ m
 Backend	==> ToÃ n bá»™ nghiá»‡p vá»¥ GIS, danger, polygon	âŒ KhÃ´ng render
 Frontend	==> Render map, marker, popup, call API	âŒ KhÃ´ng logic nghiá»‡p vá»¥

 ÄÃ¢y lÃ  kiáº¿n trÃºc Large-Scale Map System chuáº©n enterprise
 ğŸ‘‰ Sau nÃ y cÃ³:

 AI Heatmap

 Predict Disaster

 Crime Forecast
 â†’ Chá»‰ cáº§n nÃ¢ng Backend â€“ FE khÃ´ng pháº£i sá»­a logic

 BASE MAP FLOW CHUáº¨N
 Backend API
    â†“
 createBaseMapDataSource()
    â†“
 useBaseMapData()
    â†“
 mapApiToBaseIncidents()
 mapApiToBaseZones()
    â†“
 BaseIncident / BaseZone
    â†“
 mapIncidentToMarkerProps()
    â†“
 BaseMarker
    â†“
 BaseMap renders:
    - <BaseCircle />
    - <BaseMarker />
    - <BasePopup />

CÃ¡i nÃ y chÃ­nh lÃ  â€œengine dÃ¹ng cho má»i featureâ€.

BASE REPORT FLOW
Report Form (feature)
   â†“
mapFormToBaseReport()
   â†“
BaseReport
   â†“
useBaseReport()
   â†“
BaseReportDataSource.submit()
   â†“
Backend xá»­ lÃ½ háº¿t


KHI ÄÃƒ CÃ“ SHARED â†’ Má»–I FEATURE CHá»ˆ Cáº¦N OVERRIDE 6 THá»¨

features/security/
â”œâ”€â”€ config/
â”‚   â””â”€â”€ securityConfig.js
â”‚
â”œâ”€â”€ components/
â”‚   â”œâ”€â”€ SecurityMap.jsx
â”‚   â”œâ”€â”€ SecurityMarker.jsx
â”‚   â””â”€â”€ ReportSecurity.jsx
â”‚
â”œâ”€â”€ hooks/
â”‚   â”œâ”€â”€ useSecurityData.js
â”‚   â””â”€â”€ useSecurityReport.js
â”‚
â””â”€â”€ services/
    â”œâ”€â”€ SecurityAPIService.js
    â””â”€â”€ SecurityReportAPIService.js

KHÃ”NG Cáº¦N:

Incident model

Zone model

Base hook

Polygon logic

Marker logic


export const securityFormSchema = [
  { name: "title", label: "TiÃªu Ä‘á»", type: "text" },
  { name: "image", label: "áº¢nh", type: "file" },
  {
    name: "type",
    label: "Loáº¡i",
    type: "select",
    options: [
      { label: "Sá»± kiá»‡n", value: "event" },
      { label: "Cáº£nh bÃ¡o", value: "warning" },
    ],
  },
  {
    name: "severity",
    label: "Má»©c Ä‘á»™",
    type: "select",
    options: [
      { label: "Tháº¥p", value: "LOW" },
      { label: "Cao", value: "HIGH" },
    ],
  },
  { name: "description", label: "MÃ´ táº£", type: "textarea" },
];
